---
# tasks file for tools

- name: Load distribution-specific variables
  ansible.builtin.include_vars: "{{ ansible_distribution }}.yml"
  tags: ["packages"]


# - ansible.builtin.import_tasks:
#     file: code-packager.yml
#   tags: ["code-packager"]

# - ansible.builtin.import_tasks:
#     file: whisper-stream.yml
#   tags: ["whisper-stream"]

# Install essential packages
- name: Install tools packages
  tags: ["packages", "packages__tools"]
  block:
    - name: Install tools packages on Arch Linux
      community.general.pacman:
        name: "{{ packages__tools }}"
        state: present
      when:
        - ansible_distribution == "Archlinux"
        - packages__tools is defined

    - name: Install tools packages on Rocky Linux/RedHat
      ansible.builtin.dnf:
        name: "{{ packages__tools }}"
        state: present
      when:
        - ansible_distribution == "Rocky"
        - packages__tools is defined

    - name: Install tools packages on Fedora
      ansible.builtin.dnf:
        name: "{{ packages__tools }}"
        state: present
      when:
        - ansible_distribution == "Fedora"
        - packages__tools is defined

- ansible.builtin.import_tasks:
    file: obsidian.yml
  tags: ["obsidian"]

- name: Install gitflow
  tags: ["gitflow"]
  when: ansible_distribution == "Fedora"
  block:
    - name: RedHat | Enable COPR repository for git flow
      community.general.copr:
        name: "elegos/gitflow"
        state: enabled
      tags: ["repos", "copr"]

    - name: Install gitflow on Fedora
      ansible.builtin.dnf:
        name: gitflow
        state: present
        update_cache: true
      tags: ["packages"]

- name: Install lazydocker
  tags: ["lazydocker"]
  when: ansible_distribution == "Fedora"
  block:
    - name: RedHat | Enable COPR repository for lazydocker
      community.general.copr:
        name: "atim/lazydocker"
        state: enabled
      tags: ["repos", "copr"]

    - name: Install lazydocker on Fedora
      ansible.builtin.dnf:
        name: lazydocker
        state: present
        update_cache: true
      tags: ["packages"]

- ansible.builtin.import_tasks:
    file: input-remapper.yml
  tags: ["input-remapper"]

- ansible.builtin.import_tasks:
    file: vscode.yml
  tags: ["vscode"]
  when: ansible_os_family == "RedHat"

- name: Install Claude-Code
  ansible.builtin.shell: |
    npm install -g @anthropic-ai/claude-code
  register: claude_installation
  changed_when: claude_installation is changed
  tags: ["claude-code"]

- name: Install Gemini CLI
  ansible.builtin.shell: |
    npm install -g @google/gemini-cli
  register: gemini_installation
  changed_when: gemini_installation is changed
  tags: ["gemini"]
