---
# mDNS/Avahi setup

- name: Install Avahi packages
  include_role:
    name: package-manager
  vars:
    packages:
      - name: avahi
      - name: nss-mdns

- name: Enable avahi-daemon
  systemd:
    name: avahi-daemon
    enabled: true
    state: started

- name: Configure nsswitch for mDNS
  lineinfile:
    path: /etc/nsswitch.conf
    regexp: '^hosts:'
    line: 'hosts: files mdns_minimal [NOTFOUND=return] dns myhostname'
    backup: true