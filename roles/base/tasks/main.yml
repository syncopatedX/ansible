---
# ============================================================================
# Base System Configuration
# Provides foundational system setup for RedHat family distributions
# ============================================================================

# ----------------------------------------------------------------------------
# System Configuration
# ----------------------------------------------------------------------------

- name: Set system timezone
  ansible.builtin.command: "timedatectl set-timezone {{ timezone }}"
  register: timezone_result
  changed_when: timezone_result.rc == 0
  failed_when: timezone_result.rc != 0
  tags: ["timezone"]

- name: Load distribution-specific variables
  ansible.builtin.include_vars: "{{ ansible_distribution }}.yml"
  when: ansible_os_family == "RedHat"
  tags: ["packages"]

# ----------------------------------------------------------------------------
# Repository Configuration
# ----------------------------------------------------------------------------

- name: Include distribution-specific repository tasks
  ansible.builtin.include_tasks: "distro/{{ ansible_distribution }}/main.yml"
  when:
    - ansible_os_family == "RedHat"
    - enable_third_party_repos | default(true)
  tags: ["repos"]

# ----------------------------------------------------------------------------
# Package Installation
# ----------------------------------------------------------------------------

- name: Install base system packages
  tags: ["packages", "packages__base"]
  block:
    - name: Install base packages on RedHat family
      ansible.builtin.dnf:
        name: "{{ packages__base }}"
        state: present
      when: packages__base is defined

- name: Install workstation-specific packages
  tags: ["packages"]
  block:
    - name: Install Google Chrome Stable
      ansible.builtin.dnf:
        name: google-chrome-stable
        state: present
        update_cache: true
      when:
        - ansible_distribution == "Fedora"
      tags: ["google_chrome"]

# ----------------------------------------------------------------------------
# Language-Specific Package Installation
# ----------------------------------------------------------------------------

- name: Import Python package installation tasks
  ansible.builtin.import_tasks:
    file: packages/python.yml

- name: Import Rust/Cargo package installation tasks
  ansible.builtin.import_tasks:
    file: packages/rust.yml

# ----------------------------------------------------------------------------
# Bootloader Configuration
# ----------------------------------------------------------------------------

- name: Configure GRUB bootloader
  ansible.builtin.include_tasks: grub.yml
  when:
    - ansible_os_family == "RedHat"
    - bootloader == "grub"
  tags: ["grub", "bootloader"]
