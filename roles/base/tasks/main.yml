---
# Base system configuration - simplified

# Basic system setup
- name: Set timezone
  command: "timedatectl set-timezone {{ timezone }}"
  changed_when: true

- name: Set locale
  copy:
    content: "LANG={{ locale }}\n"
    dest: /etc/locale.conf
    mode: "0644"

- name: Set keymap
  copy:
    content: "KEYMAP={{ keymap }}\n" 
    dest: /etc/vconsole.conf
    mode: "0644"

# User setup
- name: Create user
  user:
    name: "{{ user.name }}"
    shell: "{{ user.shell | default('/bin/bash') }}"
    groups: "wheel,audio,video"
    append: true

- name: Setup sudo without password
  lineinfile:
    path: /etc/sudoers.d/99-user
    line: "{{ user.name }} ALL=(ALL:ALL) NOPASSWD: ALL"
    create: true
    mode: "0440"
  when: user.name != 'root'

# Install packages
- name: Install packages
  include_role:
    name: package-manager
  vars:
    packages: "{{ base_packages }}"