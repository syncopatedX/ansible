---
# Arch Linux specific setup

- name: Setup package repositories
  import_tasks: repos.yml
  when: ansible_architecture != "aarch64"
  tags: ["repos"]

- name: Install and configure paru (AUR helper)
  import_tasks: paru.yml
  when: ansible_architecture != "aarch64"
  tags: ["paru"]

- name: Configure makepkg for efficient downloads
  template:
    src: etc/makepkg.conf.j2
    dest: /etc/makepkg.conf
    mode: "0644"
    backup: true
  become: true
  tags: ["makepkg"]

- name: Update package mirrors
  shell: |
    reflector --download-timeout 2 --protocol https --latest 20 \
    --sort rate --score 15 --fastest 10 \
    --save /etc/pacman.d/mirrorlist
  become: true
  when: update_mirrors | default(false)
  tags: ["mirrors"]
