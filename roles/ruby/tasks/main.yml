---
# tasks file for ruby

- name: Load a variable file based on the OS type, or a default if not found.
  ansible.builtin.include_vars: "{{ lookup('ansible.builtin.first_found', params) }}"
  vars:
    params:
      files:
        - "{{ ansible_os_family }}.yml"
      paths:
        - "vars"
  tags: ["packages"]

- name: Load the main vars
  ansible.builtin.include_vars: main.yml
  vars:
    params:
      paths:
        - "vars"

- ansible.builtin.setup:
- ansible.builtin.debug:
    msg: "{{ packages.ruby }}"
  when: debug_vars is defined

- name: Install Ruby dev packages
  community.general.pacman:
    name: "{{ packages.ruby }}"
    state: present
  tags: ["packages"]

- when: rvm_install|default(false)|bool == true
  become: false
  tags: ["rvm"]
  block:
    - name: Install RVM
      ansible.builtin.import_tasks: "rvm.yml"
    - name: Install Ruby and Gems
      ansible.builtin.import_tasks: "rubies.yml"
