---
- hosts: server
  gather_facts: true
  vars:
    path:
      - "{{ lookup('env','HOME') }}/.local/bin"
  vars_files: 
    - "../vars/main.yml"
  environment:
    PATH: "{{ ansible_env.PATH }}:/sbin:/bin:{{ path|join(':') }}"

  pre_tasks:

    - name: Set profile config directory fact
      set_fact:
        profile_config_dir: "{{ '/etc/skel' if use_etc_skel | bool else ansible_env.HOME }}"
      tags: ['always']

  roles:

    - role: base
      become: true
      tags: ["base"]

    - role: user
      tags: ["user"]

    - role: docker
      become: true
      when: use_docker | default(false) | bool
      tags: ["docker"]

    - role: libvirt
      become: true
      when: use_libvirt | default(false) | bool
      tags: ["libvirt"]