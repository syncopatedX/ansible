---
- hosts: workstation
  gather_facts: true
  vars:
    path:
      - "{{ lookup('env','HOME') }}/.local/bin"
  vars_files: 
    - "../vars/main.yml"
  environment:
    PATH: "{{ ansible_env.PATH }}:/sbin:/bin:{{ path|join(':') }}"

  pre_tasks:

    - name: Set profile config directory fact
      set_fact:
        profile_config_dir: "{{ '/etc/skel' if use_etc_skel | bool else ansible_env.HOME }}"
      tags: ['always']
    
    - name: Set distro name
      set_fact:
        ansible_distribution: "{{ distro }}"
      when: distro is defined
      tags: ["always", "testing"]

    - name: Display ansible_distribution
      debug:
        msg: |
          The host {{ inventory_hostname }} has {{ ansible_distribution }} installed,
          which belongs to the {{ ansible_os_family }} OS family
      tags: ['always']
  roles:

    - role: base
      become: true
      tags: ["base"]

    - role: user
      tags: ["user"]

    - role: docker
      become: true
      when: use_docker | default(true) | bool
      tags: ["docker"]

    - role: libvirt
      become: true
      when: use_libvirt | default(false) | bool
      tags: ["libvirt"]

    - role: x11
      become: true
      tags: ["x11"]

    - role: sxhkd
      tags: ["sxhkd"]

    - role: rofi
      tags: ["rofi"]

    - role: xdg
      tags: ["xdg"]

    - role: i3
      tags: ["i3"]

    - role: homepage
      tags: ["homepage"]

    - role: ruby
      tags: ["ruby"]

- name: Install code-packager
  import_playbook: code-packager.yml
  tags: ["code-packager"]

- name: Install whisper-stream
  import_playbook: whisper-stream.yml
  tags: ["whisper-stream"]

- name: Install input-remapper
  import_playbook: input-remapper.yml
  tags: ["input-remapper"]