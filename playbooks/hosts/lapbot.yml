---
- name: Configure lapbot host
  hosts: lapbot
  become: true
  vars:
    bootloader: grub
    autologin: false
    display_manager: "greetd"
    desktop: "sway"
    use_libvirt: false
    rbenv_install: true
    networking: "systemd-network"
    systemd_network_networks:
      20-wired:
        Match:
          Name: eth*
          MACAddress: f0:1d:bc:f2:63:99
        Network:
          Address: 192.168.41.29/24
          Gateway: 192.168.41.1
          DNS: 192.168.41.1
          Domains: syncopated.net
          LinkLocalAddressing: false
          IPv6AcceptRA: false
      25-wireless:
        Match:
          Name: wlan*
          MACAddress: 9c:30:5b:d8:0c:1f
        Network:
          Address: 192.168.41.11/24
          Gateway: 192.168.41.1
          Domains: syncopated.net
          LinkLocalAddressing: false
          IPv6AcceptRA: false

  tasks:
    - name: Configure bootloader
      ansible.builtin.include_role:
        name: base
      when: bootloader is defined

    - name: Configure display manager
      ansible.builtin.include_role:
        name: display-manager
      when: display_manager is defined

    - name: Configure window manager
      ansible.builtin.include_role:
        name: wayland
      when: desktop == "sway"

    - name: Configure Ruby environment
      ansible.builtin.include_role:
        name: ruby
      when: rbenv_install is defined and rbenv_install

    - name: Configure systemd networking
      ansible.builtin.include_role:
        name: networking
      when: networking == "systemd-network"
