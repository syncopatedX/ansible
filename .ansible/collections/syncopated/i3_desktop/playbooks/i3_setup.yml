---
- name: i3 Desktop Environment Setup
  hosts: all
  gather_facts: true
  become: true
  vars:
    path:
      - "{{ lookup('env','HOME') }}/.cargo/bin"
      - "{{ lookup('env','HOME') }}/.local/bin"
  environment:
    PATH: "{{ ansible_env.PATH }}:/sbin:/bin:{{ path|join(':') }}"
  
  pre_tasks:
    - name: Display target system information
      ansible.builtin.debug:
        msg: |
          Setting up i3 desktop environment on {{ inventory_hostname }}
          OS: {{ ansible_distribution }} {{ ansible_distribution_major_version }}
          Family: {{ ansible_os_family }}
      tags: ["always"]

    - name: Verify window manager is set to i3
      ansible.builtin.assert:
        that:
          - window_manager is defined
          - window_manager == "i3"
        fail_msg: "This playbook requires window_manager to be set to 'i3'"
        success_msg: "Window manager correctly set to i3"
      tags: ["always"]

  roles:
    - { role: syncopated.i3_desktop.xorg, tags: ["xorg", "x11"] }
    - { role: syncopated.i3_desktop.i3, tags: ["i3", "windowmanager"] }
    - { role: syncopated.i3_desktop.dunst, tags: ["dunst", "notifications"] }
    - { role: syncopated.i3_desktop.picom, tags: ["picom", "compositor"] }
    - { role: syncopated.i3_desktop.sxhkd, tags: ["sxhkd", "hotkeys"] }

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          i3 desktop environment setup completed successfully!
          
          Configured components:
          - Xorg server and X11 utilities
          - i3 window manager
          - Dunst notification daemon  
          - Picom compositor
          - SXHKD hotkey daemon
          
          You may need to restart or logout/login to activate all changes.
      tags: ["always"]