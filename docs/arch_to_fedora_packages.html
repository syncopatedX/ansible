<!-- https://g.co/gemini/share/ffe5adc1f5e6 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arch to Fedora Package Converter (with Gemini)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1a202c;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        .suggestion-box {
            background-color: #2d3748; /* gray-800 */
            border-left: 3px solid #4fd1c5; /* teal-400 */
            padding: 0.75rem;
            margin-top: 0.5rem;
            border-radius: 0 0.375rem 0.375rem 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto bg-gray-800 rounded-2xl shadow-2xl p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-cyan-400">Arch to Fedora Package Converter</h1>
            <p class="text-gray-400 mt-2">Convert your package list and get AI-powered suggestions for unmapped packages.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Arch Linux Input -->
            <div class="flex flex-col">
                <label for="arch-input" class="text-lg font-semibold mb-2 text-gray-300">Arch Linux Packages (YAML)</label>
                <textarea id="arch-input" class="custom-scrollbar w-full h-96 bg-gray-900 border-2 border-gray-700 rounded-lg p-4 text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-300" placeholder="Paste your Archlinux.yml content here..."></textarea>
            </div>

            <!-- Fedora Output -->
            <div class="flex flex-col">
                <label for="fedora-output" class="text-lg font-semibold mb-2 text-gray-300">Fedora Packages (YAML)</label>
                <textarea id="fedora-output" readonly class="custom-scrollbar w-full h-96 bg-gray-900 border-2 border-gray-700 rounded-lg p-4 text-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300" placeholder="Fedora package list will appear here..."></textarea>
            </div>
        </main>

        <div class="text-center mt-8">
            <button id="convert-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-cyan-500 focus:ring-opacity-50">
                Convert
            </button>
             <button id="copy-btn" class="ml-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 hidden">
                Copy Output
            </button>
            <button id="ansible-btn" class="ml-4 bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-teal-500 focus:ring-opacity-50 hidden">
                ✨ Generate Ansible Task
            </button>
        </div>
        
        <div id="message-box" class="mt-6 p-4 rounded-lg text-center hidden"></div>

        <!-- Unmapped Packages -->
        <div id="unmapped-container" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-amber-400 mb-4">Unmapped Packages</h2>
            <p class="text-gray-400 mb-4">For packages without a direct mapping, you can ask Gemini for a suggestion.</p>
            <div id="unmapped-list" class="bg-gray-900 border-2 border-gray-700 rounded-lg p-4 custom-scrollbar max-h-60 overflow-y-auto">
                <!-- Unmapped packages will be listed here -->
            </div>
        </div>
        
        <!-- Ansible Task Snippet -->
        <div id="ansible-container" class="mt-8 hidden">
            <h2 class="text-2xl font-semibold text-teal-400 mb-4">✨ Ansible Task Snippet</h2>
            <p class="text-gray-400 mb-4">Here is an Ansible task snippet generated by Gemini to install the converted packages.</p>
            <div id="ansible-output-wrapper" class="bg-gray-900 border-2 border-gray-700 rounded-lg p-4 custom-scrollbar max-h-60 overflow-y-auto">
                <pre><code id="ansible-output" class="language-yaml"></code></pre>
            </div>
        </div>
    </div>

    <footer class="text-center text-gray-500 mt-8">
        <p>Powered by Gemini</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const archInput = document.getElementById('arch-input');
            const fedoraOutput = document.getElementById('fedora-output');
            const convertBtn = document.getElementById('convert-btn');
            const copyBtn = document.getElementById('copy-btn');
            const ansibleBtn = document.getElementById('ansible-btn');
            const unmappedContainer = document.getElementById('unmapped-container');
            const unmappedList = document.getElementById('unmapped-list');
            const messageBox = document.getElementById('message-box');
            const ansibleContainer = document.getElementById('ansible-container');
            const ansibleOutput = document.getElementById('ansible-output');

            // Package mapping remains the same as before
            const packageMap = {
                'acl': 'acl', 'acpi': 'acpi', 'acpid': 'acpid', 'age': 'age', 'alacritty': 'alacritty', 'ansible': 'ansible-core', 'ansible-lint': 'ansible-lint', 'aria2': 'aria2', 'aspell': 'aspell', 'aspell-en': 'aspell-en', 'atool': 'atool', 'audiofile': 'audiofile', 'autossh': 'autossh', 'bandwhich': 'bandwhich', 'base-devel': '@development-tools', 'bash-completion': 'bash-completion', 'bash-language-server': 'bash-language-server', 'bat': 'bat', 'bind': 'bind', 'bottom': 'bottom', 'bzip2': ['bzip2', 'bzip2-libs'], 'choose': 'choose-rust', 'chromaprint': 'chromaprint', 'cmake': 'cmake', 'coreutils': ['coreutils', 'coreutils-common'], 'cpupower': 'kernel-tools', 'curlie': 'curlie', 'debugedit': 'debugedit', 'dex': 'dex', 'downgrade': null, 'duf': 'duf', 'dust': 'dust', 'elinks': 'elinks', 'eza': 'eza', 'faac': 'faac', 'faad2': 'faad2', 'fakeroot': ['fakeroot', 'fakeroot-libs'], 'fd': 'fd-find', 'figlet': 'figlet', 'filesystem': 'filesystem', 'firewalld': 'firewalld', 'fsarchiver': 'fsarchiver', 'fuse-common': 'fuse', 'fuse3': 'fuse3', 'gcc': 'gcc', 'git': 'git', 'git-delta': 'git-delta', 'git-lfs': 'git-lfs', 'github-cli': 'gh', 'glibc': ['glibc', 'glibc-common'], 'glow': 'glow', 'gnome-keyring': 'gnome-keyring', 'gnuplot': 'gnuplot', 'gping': 'gping', 'graphicsmagick': 'GraphicsMagick', 'gst-libav': 'gstreamer1-libav', 'gstreamer': 'gstreamer1', 'gum': 'gum', 'highlight': 'highlight', 'hspell': 'hspell', 'htop': 'htop', 'i7z': 'i7z', 'imagemagick': 'ImageMagick', 'inetutils': 'inetutils', 'inxi': 'inxi', 'iotop': 'iotop', 'iproute2': 'iproute', 'jq': 'jq', 'keychain': 'keychain', 'libgit2': 'libgit2', 'libgit2-glib': 'libgit2-glib', 'libvips': 'vips', 'libvoikko': 'libvoikko', 'links': 'links', 'lnav': 'lnav', 'lynx': 'lynx', 'mako': 'mako', 'make': 'make', 'mediainfo': 'mediainfo', 'meld': 'meld', 'micro': 'micro', 'mosh': 'mosh', 'most': 'most', 'nano-syntax-highlighting': null, 'ncdu': 'ncdu', 'neovim': 'neovim', 'net-tools': 'net-tools', 'nodejs': 'nodejs', 'npm': 'npm', 'numlockx': 'numlockx', 'nuspell': 'nuspell', 'oh-my-zsh-git': null, 'openslide': 'openslide', 'openssh': 'openssh', 'openssl': 'openssl', 'pacman': 'dnf5', 'patch': 'patch', 'pavucontrol': 'pavucontrol', 'pkgconf': ['pkgconf', 'pkgconf-pkg-config'], 'playerctl': 'playerctl', 'podman': 'podman', 'podman-compose': 'podman-compose', 'poppler': 'poppler', 'poppler-glib': 'poppler-glib', 'procs': 'procs', 'pv': 'pv', 'python': 'python3', 'python-pip': 'python3-pip', 'python-poetry': 'python-poetry', 'ranger': 'ranger', 'rclone': 'rclone', 'reflector': null, 'ripgrep': 'ripgrep', 'rsync': 'rsync', 'ruby': 'ruby', 'sd': 'sd', 'shellcheck': 'ShellCheck', 'starship': 'starship', 'stow': 'stow', 'strace': 'strace', 'sway': 'sway', 'swaybg': 'swaybg', 'swayidle': 'swayidle', 'swaylock': 'swaylock', 'systemd': ['systemd', 'systemd-pam', 'systemd-libs'], 'tldr': 'tldr', 'tmux': 'tmux', 'toilet': 'toilet', 'tree': 'tree', 'unarchiver': 'unarchiver', 'unrar': 'unrar', 'unzip': 'unzip', 'usbutils': 'usbutils', 'vim': ['vim-enhanced', 'vim-common'], 'vulkan-tools': 'vulkan-tools', 'waybar': 'waybar', 'wget': 'wget', 'which': 'which', 'wl-clipboard': 'wl-clipboard', 'wofi': 'wofi', 'xclip': 'xclip', 'xdotool': 'xdotool', 'xfsprogs': 'xfsprogs', 'xorg-server': 'xorg-x11-server-Xorg', 'xorg-xinit': 'xorg-x11-xinit', 'xorg-xwayland': 'xorg-x11-server-Xwayland', 'yarn': 'yarnpkg', 'yazi': null, 'yt-dlp': 'yt-dlp', 'zathura': 'zathura', 'zathura-pdf-mupdf': 'zathura-pdf-mupdf', 'zoxide': 'zoxide', 'zsh': 'zsh', 'zsh-autosuggestions': 'zsh-autosuggestions', 'zsh-completions': 'zsh-completions', 'zsh-syntax-highlighting': 'zsh-syntax-highlighting'
            };

            function showMessage(message, type = 'info') {
                messageBox.textContent = message;
                messageBox.className = 'mt-6 p-4 rounded-lg text-center'; // Reset classes
                if (type === 'success') {
                    messageBox.classList.add('bg-green-900', 'text-green-200');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-900', 'text-red-200');
                } else {
                    messageBox.classList.add('bg-blue-900', 'text-blue-200');
                }
                setTimeout(() => { messageBox.classList.add('hidden'); }, 5000);
            }

            async function callGemini(prompt, buttonElement, outputElement) {
                const originalButtonText = buttonElement.innerHTML;
                buttonElement.disabled = true;
                buttonElement.innerHTML = `<svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
                outputElement.textContent = 'Asking Gemini...';
                outputElement.classList.remove('text-red-400');
                if(outputElement.parentElement.id !== 'ansible-output-wrapper') {
                   outputElement.classList.add('suggestion-box');
                }


                const apiKey = ""; // Per instructions, leave this empty.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        outputElement.textContent = text;
                    } else {
                        throw new Error("No content received from API.");
                    }
                } catch (error) {
                    outputElement.textContent = `Error: ${error.message}`;
                    outputElement.classList.add('text-red-400');
                } finally {
                    buttonElement.disabled = false;
                    buttonElement.innerHTML = originalButtonText;
                }
            }

            convertBtn.addEventListener('click', () => {
                const yamlInput = archInput.value.trim();
                if (!yamlInput) {
                    showMessage('Input cannot be empty.', 'error');
                    return;
                }
                
                // Reset UI elements
                unmappedContainer.classList.add('hidden');
                ansibleContainer.classList.add('hidden');
                ansibleBtn.classList.add('hidden');
                copyBtn.classList.add('hidden');
                unmappedList.innerHTML = '';


                try {
                    const doc = jsyaml.load(yamlInput);
                    const archPackages = doc.packages__base || [];
                    if (!Array.isArray(archPackages)) throw new Error("'packages__base' must be a list.");

                    const fedoraPackages = new Set();
                    const unmapped = [];

                    archPackages.forEach(pkg => {
                        const mapped = packageMap[pkg];
                        if (mapped) {
                            if (Array.isArray(mapped)) mapped.forEach(p => fedoraPackages.add(p));
                            else fedoraPackages.add(mapped);
                        } else {
                            fedoraPackages.add(`${pkg} # UNMAPPED`);
                            unmapped.push(pkg);
                        }
                    });

                    const outputDoc = { '#': 'Fedora specific package definitions', 'packages__base': Array.from(fedoraPackages).sort() };
                    fedoraOutput.value = jsyaml.dump(outputDoc, { indent: 2, lineWidth: -1 });
                    
                    showMessage('Conversion successful!', 'success');
                    copyBtn.classList.remove('hidden');
                    ansibleBtn.classList.remove('hidden');

                    if (unmapped.length > 0) {
                        unmappedContainer.classList.remove('hidden');
                        unmapped.forEach(pkg => {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'flex items-center justify-between bg-gray-700 p-2 rounded-md mb-2';
                            
                            const pkgName = document.createElement('span');
                            pkgName.className = 'font-mono text-amber-200';
                            pkgName.textContent = pkg;
                            
                            const controlsDiv = document.createElement('div');
                            controlsDiv.className = 'text-right';

                            const suggestBtn = document.createElement('button');
                            suggestBtn.innerHTML = '✨ Suggest';
                            suggestBtn.className = 'text-xs bg-cyan-700 hover:bg-cyan-800 text-white font-semibold py-1 px-2 rounded-md transition-colors';
                            
                            const suggestionBox = document.createElement('div');
                            suggestionBox.className = 'suggestion-box hidden';

                            suggestBtn.onclick = () => {
                                suggestionBox.classList.remove('hidden');
                                const prompt = `I am migrating from Arch Linux to Fedora. What is the Fedora equivalent for the Arch package "${pkg}"? Check official repos, RPM Fusion, and popular COPRs. If no direct match exists, suggest the closest alternative or explain why it's not needed. Keep the answer brief and to the point.`;
                                callGemini(prompt, suggestBtn, suggestionBox);
                            };
                            
                            controlsDiv.appendChild(suggestBtn);
                            controlsDiv.appendChild(suggestionBox);
                            itemDiv.appendChild(pkgName);
                            itemDiv.appendChild(controlsDiv);
                            unmappedList.appendChild(itemDiv);
                        });
                    }

                } catch (e) {
                    showMessage(`Error parsing YAML: ${e.message}`, 'error');
                    fedoraOutput.value = '';
                }
            });

            ansibleBtn.addEventListener('click', () => {
                ansibleContainer.classList.remove('hidden');
                const fedoraYaml = fedoraOutput.value;
                try {
                    const doc = jsyaml.load(fedoraYaml);
                    const packages = (doc.packages__base || []).filter(p => !p.includes('# UNMAPPED'));
                    if(packages.length === 0) {
                        ansibleOutput.textContent = "# No mapped packages to generate a task for.";
                        return;
                    }
                    const prompt = `Create a single Ansible task using the 'community.general.dnf5' module to install a list of packages in Fedora. The task should be named "Install base packages". The list of packages is: \n\n${packages.join('\n')}\n\nPresent the output as a clean YAML snippet ready to be pasted into a playbook.`;
                    callGemini(prompt, ansibleBtn, ansibleOutput);
                } catch(e) {
                    showMessage('Could not parse Fedora package list to generate Ansible task.', 'error');
                }
            });

            copyBtn.addEventListener('click', () => {
                if (fedoraOutput.value) {
                    const textarea = document.createElement('textarea');
                    textarea.value = fedoraOutput.value;
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        showMessage('Output copied to clipboard!', 'success');
                    } catch (err) {
                        showMessage('Failed to copy text.', 'error');
                    }
                    document.body.removeChild(textarea);
                }
            });

            const sampleData = `---
# Arch Linux specific package definitions
packages__base:
  - base-devel
  - bat
  - git
  - neovim
  - reflector
  - starship
  - sway
  - waybar
  - wofi
  - zsh
  - oh-my-zsh-git
  - yazi
`;
            archInput.value = sampleData;
        });
    </script>
</body>
</html>
