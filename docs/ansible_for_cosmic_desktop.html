<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide: Ansible for COSMIC Desktop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Serene Neutral -->
    <!-- Application Structure Plan: A single-page application with a persistent left-sidebar navigation for discoverability and quick access to key topics. The structure prioritizes user task-flow over the report's linear narrative. Key sections include: 1) Design Philosophy (high-level context), 2) Interactive Architecture Explorer (replaces static table), 3) A tabbed Multi-Distro Implementation view (the core interactive element, allowing users to focus on their specific OS), and 4) A Configuration Deep Dive. This non-linear, topic-driven structure was chosen to allow technically proficient users (the target audience) to immediately access the information most relevant to them, enhancing usability and comprehension. -->
    <!-- Visualization & Content Choices: 1. COSMIC Architecture: Report Info -> Component Table. Goal -> Organize/Explore. Viz -> Interactive Grid of Cards. Interaction -> Click to reveal details in a modal/expanded view. Justification -> More engaging and less overwhelming than a large table. Method -> HTML/CSS/JS. 2. Implementation Strategy: Report Info -> Multi-distro text and tables. Goal -> Compare/Inform. Viz -> Tabbed interface with an accompanying Chart.js bar chart. Interaction -> Clicking a tab filters content for a specific OS family and highlights it on the chart. Justification -> Allows direct comparison and reduces cognitive load by hiding irrelevant information. Method -> HTML/CSS/JS + Chart.js. 3. Role Structure: Report Info -> Tree command output. Goal -> Organize. Viz -> Diagram built with styled HTML divs. Justification -> A clean, web-native representation of a file tree. Method -> HTML/CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #334155; /* slate-700 */
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            border-left: 3px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #0f766e; /* teal-700 */
            background-color: #f0fdfa; /* teal-50 */
            border-left-color: #0f766e; /* teal-700 */
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: #0f766e; /* teal-700 */
            color: white;
        }
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .code-block {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white border-r border-slate-200 p-6 hidden lg:block sticky top-0 h-screen">
            <h2 class="text-xl font-bold text-slate-800 mb-6">Ansible for COSMIC</h2>
            <nav id="desktop-nav" class="space-y-2">
                <a href="#philosophy" class="nav-link block font-medium p-3 rounded-r-lg">Design Philosophy</a>
                <a href="#architecture" class="nav-link block font-medium p-3 rounded-r-lg">COSMIC Architecture</a>
                <a href="#role-blueprint" class="nav-link block font-medium p-3 rounded-r-lg">Ansible Role Blueprint</a>
                <a href="#implementation" class="nav-link block font-medium p-3 rounded-r-lg">Multi-Distro Strategy</a>
                <a href="#configuration" class="nav-link block font-medium p-3 rounded-r-lg">Configuration Deep Dive</a>
                <a href="#usage" class="nav-link block font-medium p-3 rounded-r-lg">Usage & Best Practices</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10">
            <div class="max-w-4xl mx-auto">
                
                <!-- Header -->
                <header class="mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold text-slate-900 leading-tight">Designing a Resilient Ansible Role for COSMIC Desktop</h1>
                    <p class="mt-4 text-lg text-slate-600">An interactive guide to automating the deployment of System76's next-generation desktop environment across multiple Linux distributions.</p>
                </header>

                <!-- Section: Design Philosophy -->
                <section id="philosophy" class="mb-16 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Design Philosophy</h2>
                    <p class="text-slate-600 mb-8">Automating a pre-release, rapidly changing piece of software like COSMIC requires a specific mindset. This Ansible role is built on a foundation of resilience and flexibility, learning from the past to avoid creating a brittle, unmaintainable tool. The goal is to empower users, not constrain them.</p>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-lg text-teal-700 mb-2">Idempotency & Declarative State</h3>
                            <p class="text-slate-600">The role defines the desired state, it doesn't just run commands. It can be run repeatedly, only making changes when necessary, ensuring predictable and safe execution.</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-lg text-teal-700 mb-2">Modularity & Reusability</h3>
                            <p class="text-slate-600">While it's a single role for managing COSMIC, its internal tasks are logically separated by function and operating system, promoting clarity and maintainability.</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-lg text-teal-700 mb-2">Convention over Configuration</h3>
                            <p class="text-slate-600">Sensible defaults are provided, but every critical parameter (package names, repos) is exposed as a variable. Users can adapt to upstream changes by modifying variables, not role logic.</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg border border-slate-200">
                            <h3 class="font-bold text-lg text-teal-700 mb-2">Opt-in Volatility</h3>
                            <p class="text-slate-600">By default, the role uses the most stable installation methods. Users must explicitly opt-in to track bleeding-edge development sources like COPR or the AUR.</p>
                        </div>
                    </div>
                </section>

                <!-- Section: COSMIC Architecture -->
                <section id="architecture" class="mb-16 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">COSMIC Architecture Explorer</h2>
                    <p class="text-slate-600 mb-8">To automate COSMIC, we must understand its parts. Built on a modern Rust stack, its modular design is ideal for automation. Click on a component below to see its role, key packages, and dependencies.</p>
                    <div id="architecture-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Cards will be injected by JS -->
                    </div>
                </section>

                <!-- Section: Ansible Role Blueprint -->
                <section id="role-blueprint" class="mb-16 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Ansible Role Blueprint</h2>
                    <p class="text-slate-600 mb-8">The role follows the standard `ansible-galaxy` structure. This separation of concerns is key to its flexibility. Logic, variables, templates, and metadata each have a dedicated home, making the role easy to understand and extend.</p>
                    <div class="bg-white p-6 rounded-lg border border-slate-200">
                        <div class="font-mono text-sm text-slate-700">
                            <p>cosmic_desktop/</p>
                            <div class="pl-4">
                                <p>â”œâ”€â”€ ğŸ“‚ <span class="font-semibold">defaults/</span> <span class="text-slate-500">- User-configurable variables (the role's API)</span></p>
                                <div class="pl-4 border-l ml-2">
                                    <p>â””â”€â”€ ğŸ“„ main.yml</p>
                                </div>
                                <p>â”œâ”€â”€ ğŸ“‚ <span class="font-semibold">handlers/</span> <span class="text-slate-500">- Triggered tasks (e.g., restart service)</span></p>
                                <div class="pl-4 border-l ml-2">
                                    <p>â””â”€â”€ ğŸ“„ main.yml</p>
                                </div>
                                <p>â”œâ”€â”€ ğŸ“‚ <span class="font-semibold">meta/</span> <span class="text-slate-500">- Role metadata and dependencies</span></p>
                                <div class="pl-4 border-l ml-2">
                                    <p>â””â”€â”€ ğŸ“„ main.yml</p>
                                </div>
                                <p>â”œâ”€â”€ ğŸ“‚ <span class="font-semibold">tasks/</span> <span class="text-slate-500">- The core logic of the role</span></p>
                                <div class="pl-4 border-l ml-2">
                                    <p>â”œâ”€â”€ ğŸ“„ main.yml (entrypoint)</p>
                                    <p>â”œâ”€â”€ ğŸ“„ debian.yml</p>
                                    <p>â”œâ”€â”€ ğŸ“„ redhat.yml</p>
                                    <p>â”œâ”€â”€ ğŸ“„ arch.yml</p>
                                    <p>â””â”€â”€ ğŸ“„ configure.yml</p>
                                </div>
                                <p>â””â”€â”€ ğŸ“‚ <span class="font-semibold">templates/</span> <span class="text-slate-500">- Jinja2 templates for config files</span></p>
                                <div class="pl-4 border-l ml-2">
                                    <p>â””â”€â”€ ğŸ“„ cosmic_panel_config.ron.j2</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Section: Multi-Distro Implementation -->
                <section id="implementation" class="mb-16 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Multi-Distro Implementation Strategy</h2>
                    <p class="text-slate-600 mb-8">The role's power lies in abstracting away distribution-specific complexities. A user declares their intent (e.g., `cosmic_install_method: dev`), and the role executes the correct tasks for their OS. Select your OS family below to see the specific strategy and code.</p>
                    
                    <div class="mb-8">
                        <div class="chart-container">
                            <canvas id="complexityChart"></canvas>
                        </div>
                    </div>

                    <div class="flex justify-center mb-8">
                        <div id="tabs-container" class="inline-flex rounded-lg shadow-sm bg-slate-100 p-1">
                            <button data-tab="debian" class="tab-button px-4 py-2 text-sm font-semibold rounded-md">Debian / Pop!_OS</button>
                            <button data-tab="redhat" class="tab-button px-4 py-2 text-sm font-semibold rounded-md">Fedora / Red Hat</button>
                            <button data-tab="arch" class="tab-button px-4 py-2 text-sm font-semibold rounded-md">Arch Linux</button>
                        </div>
                    </div>

                    <div id="tab-content" class="bg-white p-6 rounded-lg border border-slate-200">
                        <!-- Content will be injected by JS -->
                    </div>
                </section>

                <!-- Section: Configuration -->
                <section id="configuration" class="mb-16 scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Configuration Deep Dive</h2>
                    <p class="text-slate-600 mb-8">COSMIC uses human-readable RON (Rusty Object Notation) files for configuration, which is perfect for Ansible's templating engine. Users can define complex layouts in simple YAML variables, and the role translates them into the correct format. The role also ships default configs to fix issues in community packages where they might be missing.</p>
                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <div>
                            <h3 class="font-semibold text-lg mb-2">Example: Defining a Panel in YAML</h3>
                            <p class="text-slate-600 mb-4">In your Ansible variables, you can define a custom dock like this. The role's template will loop over this data.</p>
                            <div class="code-block">
<pre>
cosmic_panel_settings:
  - id: "main_dock"
    position: "Bottom"
    autohide: true
    applets:
      - "launcher"
      - "applications"
      - "trash"
</pre>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">Resulting Panel Structure</h3>
                            <p class="text-slate-600 mb-4">The template renders the YAML into a visual dock at the bottom of the screen.</p>
                            <div class="relative h-48 bg-slate-200 rounded-lg border-2 border-dashed border-slate-300 flex items-center justify-center">
                                <div class="absolute bottom-2 flex items-center space-x-2 bg-slate-800/80 backdrop-blur-sm p-2 rounded-lg shadow-lg">
                                    <div class="w-10 h-10 bg-teal-500 rounded-md flex items-center justify-center text-white font-bold">ğŸš€</div>
                                    <div class="w-10 h-10 bg-sky-500 rounded-md flex items-center justify-center text-white font-bold">Apps</div>
                                    <div class="w-10 h-10 bg-rose-500 rounded-md flex items-center justify-center text-white font-bold">ğŸ—‘ï¸</div>
                                </div>
                                <p class="text-slate-500">Desktop Area</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section: Usage -->
                <section id="usage" class="scroll-mt-20">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Usage & Best Practices</h2>
                    <p class="text-slate-600 mb-8">To get the most out of this role, follow standard Ansible best practices. This ensures your desktop configuration is maintainable, repeatable, and secure.</p>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <h3 class="font-semibold text-teal-700">1. Version Control Your Playbooks</h3>
                            <p class="text-slate-600">Store your playbook, inventory, and variable files (e.g., in `group_vars/`) in a Git repository. This provides change history and easy synchronization.</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <h3 class="font-semibold text-teal-700">2. Monitor Upstream Changes</h3>
                            <p class="text-slate-600">Keep an eye on the System76 blog and community packaging efforts (COPR, AUR). Since the role is variable-driven, you can often adapt to package renames by simply updating a variable.</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-slate-200">
                            <h3 class="font-semibold text-teal-700">3. Extend, Don't Modify</h3>
                            <p class="text-slate-600">Integrate personal dotfile management or other setup tasks as separate roles that run before or after this one. This layered approach keeps concerns separate and clean.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Data ---
    const architectureData = [
        { name: "COSMIC Compositor", purpose: "Wayland compositor, window management", packages: "cosmic-comp", deps: "libwayland, libseat, libinput" },
        { name: "COSMIC Panel", purpose: "Provides desktop dock and top panel", packages: "cosmic-panel", deps: "cosmic-applets" },
        { name: "COSMIC Greeter", purpose: "Login display manager", packages: "cosmic-greeter", deps: "greetd" },
        { name: "COSMIC Settings", purpose: "Settings management daemon and GUI", packages: "cosmic-settings, cosmic-settings-daemon", deps: "dbus, udev, upower" },
        { name: "COSMIC Session", purpose: "Metapackage to install the full DE", packages: "cosmic-session, cosmic-desktop", deps: "All other cosmic-* packages" },
        { name: "Keyring", purpose: "Stores secrets and passwords", packages: "gnome-keyring", deps: "libpam" },
    ];

    const implementationData = {
        debian: {
            title: "Pop!_OS & Debian-Family",
            description: "The most straightforward implementation, leveraging System76's own PPA repositories. The role ensures the correct PPA is added and then installs the core COSMIC packages using the `apt` module.",
            code: `
# tasks/debian.yml
- name: Debian | Add System76 PPA repository
  ansible.builtin.apt_repository:
    repo: "{{ cosmic_debian_repo }}"
    state: present

- name: Debian | Install COSMIC desktop packages
  ansible.builtin.apt:
    name: "{{ cosmic_debian_packages }}"
    state: present`
        },
        redhat: {
            title: "Fedora & Red Hat-Family",
            description: "For stable versions, packages are in the official Fedora repos. For development versions, the role enables a community-maintained COPR repository. It uses the `dnf` module and can optionally handle SELinux permissiveness.",
            code: `
# tasks/redhat.yml
- name: RedHat | Enable COPR for dev install
  community.general.copr:
    name: "{{ cosmic_fedora_copr_repo }}"
    state: enabled
  when: cosmic_install_method == 'dev'

- name: RedHat | Install COSMIC desktop packages
  ansible.builtin.dnf:
    name: "{{ cosmic_fedora_packages }}"
    state: present`
        },
        arch: {
            title: "Arch Linux",
            description: "The most complex path, requiring interaction with the Arch User Repository (AUR) for development versions. The role demonstrates a secure pattern of creating a temporary, non-root build user (`aur_builder`) to run `makepkg`, as it cannot be run as root.",
            code: `
# tasks/arch.yml
- name: Archlinux | Create user for AUR builds
  ansible.builtin.user:
    name: "{{ cosmic_aur_builder_user }}"
    system: yes
    shell: /usr/bin/nologin

- name: Archlinux | Install from AUR as build user
  kewlfft.aur.aur:
    use: yay
    name: "{{ cosmic_arch_packages }}"
    state: present
  become: yes
  become_user: "{{ cosmic_aur_builder_user }}"`
        }
    };

    // --- Architecture Section ---
    const archGrid = document.getElementById('architecture-grid');
    architectureData.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card bg-white p-6 rounded-lg border border-slate-200 cursor-pointer';
        card.innerHTML = `
            <h3 class="font-bold text-lg text-slate-800 mb-2">${item.name}</h3>
            <p class="text-slate-600 text-sm">${item.purpose}</p>
            <div class="mt-4 text-xs">
                <p><strong class="text-slate-500">Package:</strong> ${item.packages}</p>
                <p><strong class="text-slate-500">Depends on:</strong> ${item.deps}</p>
            </div>
        `;
        archGrid.appendChild(card);
    });

    // --- Implementation Tabs ---
    const tabsContainer = document.getElementById('tabs-container');
    const tabContent = document.getElementById('tab-content');
    const tabButtons = tabsContainer.querySelectorAll('.tab-button');

    function updateTabContent(tabId) {
        const content = implementationData[tabId];
        if (!content) return;

        tabContent.innerHTML = `
            <h3 class="text-xl font-bold text-slate-800 mb-4">${content.title}</h3>
            <p class="text-slate-600 mb-6">${content.description}</p>
            <div class="code-block"><pre>${content.code.trim()}</pre></div>
        `;

        tabButtons.forEach(button => {
            button.classList.toggle('active', button.dataset.tab === tabId);
        });
        
        updateChart(tabId);
    }

    tabsContainer.addEventListener('click', (e) => {
        if (e.target.matches('.tab-button')) {
            const tabId = e.target.dataset.tab;
            updateTabContent(tabId);
        }
    });
    
    // --- Chart.js ---
    const ctx = document.getElementById('complexityChart').getContext('2d');
    const chartData = {
        labels: ['Debian', 'Fedora', 'Arch Linux'],
        datasets: [{
            label: 'Relative Setup Complexity',
            data: [2, 3, 5],
            backgroundColor: [
                'rgba(13, 148, 136, 0.2)', // teal-600
                'rgba(14, 165, 233, 0.2)', // sky-500
                'rgba(244, 63, 94, 0.2)'    // rose-500
            ],
            borderColor: [
                'rgb(13, 148, 136)',
                'rgb(14, 165, 233)',
                'rgb(244, 63, 94)'
            ],
            borderWidth: 2
        }]
    };
    
    const complexityChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    beginAtZero: true,
                    title: { display: true, text: 'Complexity Score (Illustrative)' }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: true
                }
            }
        }
    });

    function updateChart(selectedTab) {
        const backgroundColors = [
            'rgba(13, 148, 136, 0.2)',
            'rgba(14, 165, 233, 0.2)',
            'rgba(244, 63, 94, 0.2)'
        ];
        const borderColors = [
            'rgb(13, 148, 136)',
            'rgb(14, 165, 233)',
            'rgb(244, 63, 94)'
        ];

        let selectedIndex = 0;
        if (selectedTab === 'redhat') selectedIndex = 1;
        if (selectedTab === 'arch') selectedIndex = 2;

        backgroundColors[selectedIndex] = backgroundColors[selectedIndex].replace('0.2', '0.7');

        complexityChart.data.datasets[0].backgroundColor = backgroundColors;
        complexityChart.data.datasets[0].borderColor = borderColors;
        complexityChart.update();
    }

    // --- Nav Highlighting on Scroll ---
    const sections = document.querySelectorAll('section');
    const navLinks = document.querySelectorAll('.nav-link');

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                });
            }
        });
    }, { rootMargin: "-50% 0px -50% 0px" });

    sections.forEach(section => {
        observer.observe(section);
    });

    // --- Initial State ---
    updateTabContent('debian');
    document.querySelector('.nav-link').classList.add('active');

});
</script>
</body>
</html>
<!-- https://g.co/gemini/share/fc45aafb03de -->