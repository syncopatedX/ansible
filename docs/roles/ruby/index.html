<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-T">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Collection: Ruby Environment Knowledge Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .kb-content h2 { font-size: 1.5em; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        .kb-content h3 { font-size: 1.25em; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .kb-content h4 { font-size: 1.1em; font-weight: 600; margin-top: 1rem; margin-bottom: 0.25rem; }
        .kb-content p { margin-bottom: 1rem; line-height: 1.6; }
        .kb-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .kb-content ol { list-style-type: decimal; margin-left: 1.5rem; margin-bottom: 1rem; }
        .kb-content li { margin-bottom: 0.5rem; }
        .kb-content a { color: #2563eb; text-decoration: underline; }
        .kb-content a:hover { color: #1d4ed8; }
        .kb-content pre {
            background-color: #1f2937; /* Tailwind gray-800 */
            color: #f3f4f6; /* Tailwind gray-100 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            position: relative;
        }
        .kb-content code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        .kb-content pre code {
             color: #f3f4f6; /* Tailwind gray-100 */
        }
        .kb-content :not(pre) > code { /* Inline code */
            background-color: #e5e7eb; /* Tailwind gray-200 */
            color: #1f2937; /* Tailwind gray-800 */
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
        }
        .kb-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }
        .kb-content th, .kb-content td {
            border: 1px solid #e5e7eb; /* Tailwind gray-200 */
            padding: 0.5rem;
            text-align: left;
        }
        .kb-content th {
            background-color: #f9fafb; /* Tailwind gray-50 */
        }
        .copy-code-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4b5563; /* Tailwind gray-600 */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .copy-code-btn:hover {
            opacity: 1;
        }
        .nav-item.active {
            background-color: #e0f2fe; /* Tailwind sky-100 */
            color: #0c4a6e; /* Tailwind sky-800 */
            font-weight: 600;
        }
        .nav-item ul { margin-left: 1rem; }
        .nav-item > span:hover, .nav-item > a:hover {
             background-color: #f0f9ff; /* Tailwind sky-50 */
        }
         .highlight {
            background-color: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="flex flex-col h-screen">
        <header class="bg-gray-800 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-semibold">Ansible Collection: Ruby Environment Setup</h1>
                <div class="w-full max-w-xs">
                    <input type="search" id="search-input" placeholder="Search knowledge base..." class="w-full p-2 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <aside id="sidebar" class="w-1/4 bg-white p-4 overflow-y-auto shadow-lg space-y-2 border-r border-gray-200">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">Navigation</h2>
                <nav id="kb-navigation" class="space-y-1">
                    </nav>
            </aside>

            <main id="main-content" class="flex-1 p-6 md:p-8 overflow-y-auto bg-gray-50">
                <div id="content-display" class="prose max-w-none kb-content bg-white p-6 rounded-lg shadow">
                    <h2 class="text-2xl font-bold text-gray-700">Welcome!</h2>
                    <p>Select a topic from the navigation menu to display its content here.</p>
                    <p>This is an interactive knowledge base for setting up Ruby environments on Linux, with a focus on Ansible automation. Due to the extensive nature of the source material, only a subset of sections is implemented here for demonstration purposes.</p>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- Knowledge Base Data ---
        // For a full application, this data would be more extensive.
        // Content is pre-formatted HTML for simplicity in this example.
        const knowledgeBase = [
            {
                id: 'intro', title: 'I. Introduction to Ruby and its Development Environment', level: 1, parent: null,
                content: `<h2>I. Introduction to Ruby and its Development Environment</h2><p>This section provides an overview of Ruby and the importance of a well-configured development environment.</p>`
            },
            {
                id: 'intro-what-is-ruby', title: 'A. What is Ruby?', level: 2, parent: 'intro',
                content: `<h3>A. What is Ruby?</h3>
                          <p>Ruby is a dynamic, open-source programming language with a focus on simplicity and productivity. It features an elegant syntax that is natural to read and easy to write.[1] As an interpreted, object-oriented language, Ruby is highly versatile, finding common application in web development, particularly with the Ruby on Rails framework, as well as for scripting, automation tasks, and building DevOps tools.[1] Its design philosophy emphasizes developer happiness, often leading to faster development cycles.</p>`
            },
            {
                id: 'intro-importance', title: 'B. Importance of a Well-Configured Ruby Environment', level: 2, parent: 'intro',
                content: `<h3>B. Importance of a Well-Configured Ruby Environment</h3>
                          <p>A meticulously configured Ruby environment is paramount for efficient and reliable software development. Key benefits include:</p>
                          <ul>
                              <li><strong>Version Management:</strong> Different projects may require distinct Ruby versions. A well-structured environment allows developers to seamlessly switch between these versions without conflicts.[2]</li>
                              <li><strong>Dependency Isolation:</strong> Applications depend on various external libraries (gems). Proper environment setup, often facilitated by tools like Bundler and version managers, isolates these dependencies on a per-project basis, preventing version clashes and ensuring that each project uses the exact gem versions it was tested with.[3]</li>
                              <li><strong>Reproducibility:</strong> A consistent environment across development, testing, and production stages is crucial for reproducibility. This minimizes the "it works on my machine" problem and ensures that deployments behave as expected.[4, 5]</li>
                              <li><strong>Permission Management:</strong> Installing gems and managing Ruby versions without requiring system-wide (root) privileges enhances security and prevents accidental modification of system files.[6, 7]</li>
                          </ul>
                          <p>The evolution of Ruby means that new versions introduce changes, additions, and sometimes deletions of features. Consequently, applications built for older Ruby versions might not function correctly with newer ones, necessitating the ability to manage multiple Ruby installations concurrently.[2]</p>`
            },
            {
                id: 'intro-overview-methods', title: 'C. Overview of Installation Methods', level: 2, parent: 'intro',
                content: `<h3>C. Overview of Installation Methods</h3>
                          <p>Setting up a Ruby environment on Linux can be approached in several ways:</p>
                          <ol>
                              <li><strong>System-Wide Installation:</strong> Using the distribution's package manager (e.g., <code>apt</code>, <code>yum</code>) to install Ruby. This is generally simpler but less flexible for managing multiple versions.</li>
                              <li><strong>Manual User-Specific Installation via Version Managers:</strong> This is the recommended approach for developers.
                                  <ul>
                                      <li><strong>RVM (Ruby Version Manager):</strong> A feature-rich command-line tool that allows installing, managing, and working with multiple Ruby environments, including distinct sets of gems (gemsets).[6]</li>
                                      <li><strong>rbenv:</strong> A more lightweight tool that focuses on switching Ruby versions, typically used in conjunction with the <code>ruby-build</code> plugin for installing Rubies.[2, 8]</li>
                                  </ul>
                              </li>
                              <li><strong>Automation:</strong>
                                  <ul>
                                      <li><strong>Ansible:</strong> An automation tool that can be used to codify and consistently reproduce Ruby environment setups across multiple machines using Ansible roles.</li>
                                  </ul>
                              </li>
                          </ol>
                          <p>This guide will delve into manual installation using RVM and rbenv, cover gem and dependency management with RubyGems and Bundler, and provide a comprehensive walkthrough for automating the setup using an Ansible role.</p>`
            },
            {
                id: 'manual-install', title: 'II. Manual Ruby Installation and Configuration on Linux', level: 1, parent: null,
                content: `<h2>II. Manual Ruby Installation and Configuration on Linux</h2>
                          <p>Choosing the right installation method is crucial for a manageable and flexible Ruby development workflow. While system package managers offer a quick way to get Ruby, version managers provide superior control for development purposes.</p>`
            },
            {
                id: 'manual-system-vs-user', title: 'A. System-Wide vs. User-Specific Installation', level: 2, parent: 'manual-install',
                content: `<h3>A. System-Wide vs. User-Specific Installation</h3>
                          <p>Many Linux distributions offer Ruby through their native package managers. For instance, on Debian-based systems like Ubuntu, Ruby can be installed using a command like <code>$ sudo apt-get install ruby-full</code>.[9] This method typically installs Ruby in system directories (e.g., <code>/usr/bin/ruby</code>, <code>/usr/lib/ruby</code>) [7], making it available to all users on the system.</p>
                          <h4>Advantages of System-Wide Installation:</h4>
                          <ul>
                              <li><strong>Simplicity:</strong> For single-user machines or servers dedicated to a single Ruby application that doesn't require version flexibility, this can be the simplest setup method.</li>
                              <li><strong>System Integration:</strong> System updates managed by the package manager might, in some cases, include updates for Ruby, potentially simplifying maintenance for system administrators.[10]</li>
                          </ul>
                          <h4>Disadvantages of System-Wide Installation:</h4>
                          <ul>
                              <li><strong>Permission Issues:</strong> Installing gems often requires <code>sudo</code> privileges, as gems are installed into system directories. This can be a security concern and is generally inconvenient for development.[2, 7]</li>
                              <li><strong>Version Rigidity:</strong> System package managers usually provide a specific version of Ruby, which may not be the latest or the version required by a particular project. Upgrading or downgrading this system Ruby can be cumbersome and may affect other system utilities relying on it.[2]</li>
                              <li><strong>Multiple Project Conflicts:</strong> If multiple projects on the same machine require different Ruby versions, a single system-wide installation is inadequate.[2]</li>
                              <li><strong>Outdated Versions:</strong> The Ruby version provided by distribution repositories is often not the most current release.[7] This can prevent developers from using the latest language features or security patches.</li>
                          </ul>
                          <p>The "System Ruby Trap" is a common pitfall where developers initially use the pre-installed or package-manager-installed Ruby for convenience. However, they soon encounter limitations related to gem installation permissions (requiring <code>sudo</code>) and the inability to switch Ruby versions for different projects. This quickly becomes a bottleneck, highlighting the need for more sophisticated version management tools.</p>
                          <h4>User-Specific Installations (via Version Managers):</h4>
                          <p>For development, user-specific installations managed by tools like RVM or rbenv are strongly recommended.[2, 6] These tools install Ruby versions (and often their gems) within a user's home directory (e.g., <code>~/.rvm</code> or <code>~/.rbenv</code>), thereby avoiding permission issues and allowing for easy management of multiple Ruby versions concurrently. This approach aligns better with the needs of modern development, where different projects often have varying Ruby version requirements.</p>`
            },
            {
                id: 'manual-rvm', title: 'B. Using Ruby Version Manager (RVM)', level: 2, parent: 'manual-install',
                content: `<h3>B. Using Ruby Version Manager (RVM)</h3><p>Details about RVM installation and usage.</p>`
            },
            {
                id: 'manual-rvm-intro', title: '1. Introduction to RVM', level: 3, parent: 'manual-rvm',
                content: `<h4>1. Introduction to RVM</h4>
                          <p>RVM (Ruby Version Manager) is a command-line tool that facilitates the installation, management, and usage of multiple Ruby environments. It allows developers to have several Ruby versions installed simultaneously and switch between them effortlessly. RVM also supports "gemsets," which are isolated collections of gems specific to a Ruby version, preventing gem conflicts between projects.[3, 6, 11, 12]</p>`
            },
            {
                id: 'manual-rvm-install', title: '2. RVM Installation', level: 3, parent: 'manual-rvm',
                content: `<h4>2. RVM Installation</h4>
                          <p>RVM can be installed for a single user or system-wide. For development purposes, a single-user installation (typically in <code>~/.rvm</code>) is highly recommended as it avoids permission complexities.[6, 11]</p>
                          <h5>Prerequisites:</h5>
                          <p>Before installing RVM, certain tools must be present on the system. These generally include:</p>
                          <ul>
                              <li><code>bash</code> (version 3.2.25+ or 4.2+)</li>
                              <li><code>curl</code> (for downloading the installer script)</li>
                              <li><code>gpg2</code> or <code>gpg</code> (for verifying RVM release signatures)</li>
                              <li>Standard GNU utilities such as <code>awk</code>, <code>sed</code>, <code>grep</code>, <code>which</code>, <code>ls</code>, <code>cp</code>, <code>tar</code>, <code>gunzip</code>, <code>bunzip2</code>.[11, 12]</li>
                              <li><code>git</code> (version 1.7.6+) is required if you plan to install development (<code>-head</code>) versions of Ruby.[12]</li>
                          </ul>
                          <h5>Installation Steps (Single-User):</h5>
                          <ol>
                              <li><strong>Install GPG Keys:</strong> Import RVM's GPG keys to verify the installation script's authenticity. For example:
                                  <pre><code class="language-bash">gpg --keyserver keyserver.ubuntu.com --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</code></pre>
                              </li>
                              <li><strong>Download and Run the Installation Script:</strong> Use <code>curl</code> to download the RVM installation script and pipe it to <code>bash</code>.
                                  <pre><code class="language-bash">curl -sSL https://get.rvm.io -o rvm-install.sh
# Inspect rvm-install.sh if desired
bash rvm-install.sh stable --ruby</code></pre>
                              </li>
                              <li><strong>Source RVM Script:</strong> Add the following line to your shell's configuration file (e.g., <code>~/.bashrc</code>, <code>~/.bash_profile</code>, or <code>~/.zshrc</code>).
                                  <pre><code class="language-bash">[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm" # Load RVM into a shell session *as a function*</code></pre>
                                  Then, source the profile file or open a new terminal session:
                                  <pre><code class="language-bash">source ~/.bashrc  # Or your specific profile file</code></pre>
                              </li>
                              <li><strong>Verify Installation:</strong> Check if RVM is loaded:
                                  <pre><code class="language-bash">type rvm | head -1
rvm --version</code></pre>
                              </li>
                              <li><strong>Disable Automatic Library Installation (Optional but Recommended):</strong>
                                  <pre><code class="language-bash">rvm autolibs disable</code></pre>
                              </li>
                          </ol>`
            },
            {
                id: 'ansible-automation', title: 'IV. Automating Ruby Environment Setup with Ansible', level: 1, parent: null,
                content: `<h2>IV. Automating Ruby Environment Setup with Ansible</h2><p>Automating the setup of a Ruby development environment using Ansible ensures consistency, repeatability, and efficiency, especially when provisioning multiple developer machines or servers. Ansible roles provide a structured way to organize and reuse automation logic.</p>`
            },
            {
                id: 'ansible-intro', title: 'A. Introduction to Ansible and Ansible Roles', level: 2, parent: 'ansible-automation',
                content: `<h3>A. Introduction to Ansible and Ansible Roles</h3>
                          <p><strong>Ansible</strong> is an open-source automation tool that simplifies IT orchestration, configuration management, and application deployment. It operates in an agentless manner, typically communicating with managed nodes over SSH.</p>
                          <p><strong>Ansible Roles</strong> are a way of organizing Ansible content (tasks, variables, handlers, templates, files, and metadata) into self-contained, reusable units. Roles promote modularity and make complex playbooks easier to understand and maintain.[58] A standard Ansible role directory structure includes [58]:</p>
                          <ul>
                              <li><code>tasks/</code>: Contains the main list of tasks to be executed by the role.</li>
                              <li><code>handlers/</code>: Contains handlers, which are tasks triggered by <code>notify</code> directives in other tasks.</li>
                              <li><code>defaults/</code>: Contains default variables for the role.</li>
                              <li><code>vars/</code>: Contains variables for the role that have higher precedence.</li>
                              <li><code>files/</code>: Contains static files that can be copied to managed nodes.</li>
                              <li><code>templates/</code>: Contains file templates (usually Jinja2 format).</li>
                              <li><code>meta/</code>: Contains metadata for the role, including dependencies.</li>
                          </ul>
                          <p>Using roles allows for adherence to design principles like separation of concerns, improving collaboration as different team members can work on distinct roles concurrently.[58, 59]</p>`
            },
             {
                id: 'troubleshooting', title: 'V. Troubleshooting Common Ruby Environment Issues', level: 1, parent: null,
                content: `<h2>V. Troubleshooting Common Ruby Environment Issues on Linux</h2><p>This section covers common problems and their solutions.</p>
                         <p class="text-sm text-gray-600 italic mt-4">Note: The full content for all troubleshooting sections is extensive. Specific sub-sections would be populated here in a complete implementation.</p>`
            },

        ];

        const kbNavigation = document.getElementById('kb-navigation');
        const contentDisplay = document.getElementById('content-display');
        const searchInput = document.getElementById('search-input');

        function buildNavigation(parentId = null, items = knowledgeBase) {
            const filteredItems = items.filter(item => item.parent === parentId);
            if (filteredItems.length === 0) return '';

            let html = '<ul class="space-y-1">';
            filteredItems.forEach(item => {
                const hasChildren = items.some(child => child.parent === item.id);
                html += `<li class="nav-item rounded-md text-sm" data-id="${item.id}" data-title="${item.title.toLowerCase()}">`;
                html += `<a href="#${item.id}" class="block p-2 rounded-md hover:bg-sky-50 transition-colors duration-150">${item.title}</a>`;
                if (hasChildren) {
                    html += buildNavigation(item.id, items);
                }
                html += '</li>';
            });
            html += '</ul>';
            return html;
        }

        function displayContent(itemId) {
            const item = knowledgeBase.find(i => i.id === itemId);
            if (item) {
                contentDisplay.innerHTML = item.content;
                document.querySelectorAll('#content-display pre').forEach(pre => {
                    const button = document.createElement('button');
                    button.innerText = 'Copy';
                    button.className = 'copy-code-btn';
                    button.onclick = () => copyCode(pre);
                    pre.appendChild(button);
                });
                updateActiveNavItem(itemId);
            } else {
                contentDisplay.innerHTML = '<h2>Content not found</h2><p>Please select another topic.</p>';
                updateActiveNavItem(null);
            }
            contentDisplay.scrollTop = 0; // Scroll to top of content
        }

        function copyCode(preElement) {
            const codeElement = preElement.querySelector('code');
            const textToCopy = codeElement ? codeElement.innerText : preElement.innerText;

            // Fallback for document.execCommand
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const copyButton = preElement.querySelector('.copy-code-btn');
                if(copyButton) {
                    copyButton.innerText = 'Copied!';
                    setTimeout(() => { copyButton.innerText = 'Copy'; }, 2000);
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                alert('Failed to copy code. Please copy manually.');
            }
            document.body.removeChild(textArea);
        }


        function updateActiveNavItem(activeId) {
            document.querySelectorAll('#kb-navigation .nav-item').forEach(navLi => {
                navLi.classList.remove('active');
                const link = navLi.querySelector('a');
                if (link && link.getAttribute('href') === `#${activeId}`) {
                    navLi.classList.add('active');
                }
            });
        }

        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            const navItems = document.querySelectorAll('#kb-navigation .nav-item');
            navItems.forEach(itemEl => {
                const title = itemEl.dataset.title;
                const matches = title.includes(searchTerm);
                itemEl.style.display = matches ? '' : 'none';

                // If a parent is hidden, but a child matches, we might need more complex logic
                // For simplicity, this hides non-matching items.
                // To show parents of matching children, we'd need to traverse up.
            });
        }

        function handleHashChange() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                displayContent(hash);
            } else if (knowledgeBase.length > 0) {
                // Display the first item or a welcome message if no hash
                // displayContent(knowledgeBase[0].id); // Optionally display first item
            }
        }

        // Event Listeners
        kbNavigation.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && e.target.getAttribute('href').startsWith('#')) {
                // e.preventDefault(); // Prevent default if not using hash for navigation state
                const itemId = e.target.getAttribute('href').substring(1);
                displayContent(itemId);
            }
        });

        searchInput.addEventListener('input', handleSearch);

        window.addEventListener('hashchange', handleHashChange);

        // Initial setup
        kbNavigation.innerHTML = buildNavigation();
        handleHashChange(); // Load content based on initial URL hash

    </script>
</body>
</html>
